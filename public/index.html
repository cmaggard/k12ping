<!doctype HTML>
<html>
  <head>
    <title>K12 Ping</title>
    <script src="js/d3.v2.js" type="text/javascript"></script>
    <style>
      path {
        fill: #131;
        stroke: #fff;
        stroke-width: 1;
      };
    </style>
  </head>
  <body>
    <div id="container">
      <svg id="svg" width="960" height="500"></svg>
    </div>

    <script type="text/javascript">

var xy = d3.geo.albers();
var path = d3.geo.path(xy);

d3.json("data/us-states.json", function(collection) {
    d3.select("#svg").append("svg:g").attr("id", "states")
    .selectAll("path")
      .data(collection.features)
    .enter().append("path")
      .attr("d", path);
  console.log(collection);
});

var ping = function(elem) {
  elem
    .style("stroke-width", 2)
    .attr("r", 0.5)
    .style("stroke", "salmon")
    //.style("fill", "red")
    .style("fill", "none")
    .style("opacity", 0)
    .transition()
      .delay(function(d, i) { return i * 100 })
  //    .ease("exp")
      .style("opacity", 1)
      .duration(1)
    .transition()
      .duration(3000)
      .attr("r", 20)
      //.style("opacity", -1)
      .style("stroke-opacity", 0)
      .style("stroke-width", 0)
}

d3.csv("http://homeroom.dev/activity_progresses/derp.csv", function(collection) {
    console.log(collection);
    d3.select("#svg").append("svg:g").attr("id", "pings").selectAll("circle")
      .data(collection)
      .enter().append("circle")
        .attr("cx", function(d,i) { return xy([d.long, d.lat])[0] })
        .attr("cy", function(d,i) { return xy([d.long, d.lat])[1] })
        .call(ping);
});

var pulseMe = function(geo) {
  var lat = geo.coords.latitude,
      lon = geo.coords.longitude;
  console.log(lat, lon);
  var proj = xy([lon, lat]);
  console.log(proj);
  var x = proj[0], y = proj[1];
  d3.select("#svg").append("circle")
    .attr("cx", x) 
    .attr("cy", y)
    .call(ping)
}

// navigator.geolocation.getCurrentPosition(pulseMe, function(err) {});

//var svg = d3.select("#container")
//            .append("svg:svg")
//            .attr("width", 800)
//            .attr("height", 600);
//
//d3.select("svg:svg")

    </script>
  </body>
</html>

